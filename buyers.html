<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>買家資料管理</title>
<style>
  body { font-family: '標楷體','Times New Roman',serif; background:#f8f9fa; padding:20px;}
  h1 { text-align:center; }
  table { width:100%; border-collapse:collapse; margin-top:20px; background:white; }
  th,td { border:1px solid #ccc; padding:8px; text-align:center; }
  th { background:#ff6600; color:white; cursor:pointer; }
  .search-box { margin:10px 0; text-align:center; }
  .search-box input { padding:6px; width:50%; }
  button { background:#ff6600; color:white; border:none; border-radius:4px; padding:6px 12px; cursor:pointer; }
  button:hover { background:#cc5200; }
</style>
</head>
<body>
<h1>買家資料列表</h1>
<div class="search-box">
  <input id="search" type="text" placeholder="搜尋暱稱或Email">
  <button onclick="downloadCSV()">下載CSV</button>
</div>
<table>
  <thead>
    <tr>
      <th>暱稱</th>
      <th>Email</th>
      <th>註冊時間</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody id="buyerTable"></tbody>
</table>

<script>
const buyers = JSON.parse(localStorage.getItem("allBuyers") || "[]");
const tbody = document.getElementById("buyerTable");
function renderTable(data){
  tbody.innerHTML = "";
  data.forEach((b,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${b.nickname}</td><td>${b.email}</td><td>${b.date}</td>
      <td><button onclick="deleteBuyer(${i})">刪除</button></td>`;
    tbody.appendChild(tr);
  });
}
renderTable(buyers);

function deleteBuyer(index){
  if(confirm("確定刪除此買家？")){
    buyers.splice(index,1);
    localStorage.setItem("allBuyers", JSON.stringify(buyers));
    renderTable(buyers);
  }
}

document.getElementById("search").addEventListener("input", function(){
  const kw = this.value.toLowerCase();
  renderTable(buyers.filter(b => b.nickname.toLowerCase().includes(kw) || b.email.toLowerCase().includes(kw)));
});

function downloadCSV(){
  let csv = "暱稱,Email,註冊時間\n";
  buyers.forEach(b => csv += `${b.nickname},${b.email},${b.date}\n`);
  const blob = new Blob([csv], {type: 'text/csv'});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "buyers.csv";
  a.click();
}
</script>
  <script type="module" src="firebase-init.js"></script>
</body>
</html>
