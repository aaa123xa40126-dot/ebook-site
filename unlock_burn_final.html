<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>火種解鎖儀式・可點擊穩定版（2s）</title>
<style>
:root{
  --orange:#ffb86b; --orange2:#ff8c1a; --gold:#ffdca8;
}
html,body{
  margin:0;padding:0;height:100%;background:#000;color:var(--orange);
  font-family:'DFKai-SB','標楷體','Times New Roman',Times,serif;
  overflow:hidden;
}
/* 內容層（會被「吃掉」） */
.wrap{
  position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:5;
}
.panel{
  width:min(720px,92%); border:1px solid var(--orange); border-radius:14px; padding:28px 22px;
  text-align:center; line-height:1.9; box-shadow:0 0 24px rgba(255,184,107,.08) inset; background:#000;
}
.title{ font-size:1.3rem; letter-spacing:2px; margin-bottom:12px; }
.input{
  width:95%; max-width:700px; padding:14px 16px; font-size:1.1rem;
  border:1px solid color-mix(in oklab,var(--orange),#000 40%);
  border-radius:10px; background:#0b0b0b; color:var(--orange);
  box-sizing:border-box; margin:0 auto; display:block;
}
/* 按鈕：呼吸式火光 + 置頂確保可點 */
.btn{
  margin-top:16px; display:inline-block; border:1px solid var(--orange);
  padding:10px 20px; border-radius:12px; color:var(--orange);
  text-decoration:none; cursor:pointer; transition:all .2s ease;
  position:relative; z-index:100; /* ✅ 永遠在最上層可被點擊 */
  animation: breathe 1.6s ease-in-out infinite alternate;
}
.btn:hover{ color:var(--gold); box-shadow:0 0 14px rgba(255,184,107,.55), inset 0 0 8px rgba(255,184,107,.18); }
@keyframes breathe { from{ filter:brightness(1); } to{ filter:brightness(1.25); } }

/* 🔥 燒蝕遮罩層：預設不顯示，點擊才啟用（避免遮住按鈕） */
.maskLayer{
  position:fixed; inset:0; z-index:10; display:none; pointer-events:none; /* ✅不擋互動 */
}
.whiteCore, .goldGlow, .edgeNoise { position:absolute; inset:0; opacity:0; }
.whiteCore{
  background: radial-gradient(circle at 50% 50%, #fff5e1 0%, rgba(255,245,225,0) 65%);
  clip-path: circle(120% at 50% 50%); /* 外圍開始收縮到中心 */
}
.goldGlow{
  background: radial-gradient(40% 40% at 50% 50%, rgba(255,184,107,.35) 0%, rgba(255,140,26,.28) 30%, rgba(255,140,26,0) 60%);
  mix-blend-mode: screen;
  clip-path: circle(120% at 50% 50%);
}
/* 抽象破損邊緣（噪點遮罩） */
.edgeNoise{
  --noise:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="240" height="240"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3"/></filter><rect width="100%" height="100%" filter="url(%23n)" fill="black"/></svg>');
  background:
    radial-gradient(closest-side, rgba(0,0,0,0) 60%, rgba(0,0,0,0.35) 75%, rgba(0,0,0,0.7) 85%, rgba(0,0,0,0.95) 92%, rgba(0,0,0,1) 100%);
  -webkit-mask: var(--noise); mask: var(--noise);
  clip-path: circle(120% at 50% 50%); mix-blend-mode: multiply; opacity:0;
}

/* 火星粒子層（跟著邊界向內走） */
.sparks{ position:fixed; inset:0; pointer-events:none; z-index:12; display:none; }
.spark{ position:absolute; width:3px; height:3px; border-radius:50%; opacity:0;
  filter: drop-shadow(0 0 6px rgba(255,184,107,.9)); }
@keyframes sparkInward{
  0%{ transform: translate(var(--sx), var(--sy)) scale(1); opacity:0; }
  10%{ opacity:1; }
  100%{ transform: translate(0,0) scale(0.7); opacity:0; }
}

/* 內容被吃掉（透明）+ 遮罩收縮 */
.fadeContent{ transition: opacity 2s ease; opacity:0; }       /* ✅ 2 秒 */
@keyframes shrinkIn{
  0%{ clip-path: circle(120% at 50% 50%); opacity:1; }
  70%{ clip-path: circle(12%  at 50% 50%); opacity:1; }
  100%{ clip-path: circle(6%   at 50% 50%); opacity:0; }
}
.run .whiteCore{ animation: shrinkIn 2s cubic-bezier(.25,.6,.3,1) forwards; opacity:1; }
.run .goldGlow{  animation: shrinkIn 2s cubic-bezier(.25,.6,.3,1) forwards, breathe 1.1s ease-in-out infinite alternate; opacity:1; }
.run .edgeNoise{ animation: shrinkIn 2s ease forwards; opacity:.55; }

/* 結尾文字 */
.fireText{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
  font-size:1.6rem; color:var(--orange2); z-index:20; opacity:0; }
@keyframes textFade{ 0%{opacity:0;} 20%{opacity:1;} 100%{opacity:0;} }
</style>
</head>
<body>
  <!-- 內容層 -->
  <div class="wrap" id="contentWrap">
    <div class="panel">
      <div class="title">請輸入您的專屬火種序號</div>
      <input class="input" placeholder="例如：A3F9KZ72XZ"/>
      <a id="ignite" class="btn">點燃火種</a>
    </div>
  </div>

  <!-- 燒蝕遮罩層（點擊後才顯示） -->
  <div class="maskLayer" id="mask">
    <div class="whiteCore"></div>
    <div class="goldGlow"></div>
    <div class="edgeNoise"></div>
  </div>

  <!-- 粒子（點擊後才生成） -->
  <div class="sparks" id="sparks"></div>

  <!-- 結尾文字 -->
  <div class="fireText" id="fireText">火種被點燃了....</div>

<script>
let audioCtx=null;

/* 音效：焚燒 + 最後的「呼」 */
function playSounds(){
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const ctx = audioCtx;

    // 焚燒聲（2s）
    const dur=2.0, sr=ctx.sampleRate, len=sr*dur, buf=ctx.createBuffer(1,len,sr), d=buf.getChannelData(0);
    for(let i=0;i<len;i++) d[i] = (Math.random()*2-1)*0.16; // 白噪底
    for(let k=0;k<90;k++){                                  // crackle
      const p=Math.floor(Math.random()*len);
      const w=Math.floor(sr*(0.002+Math.random()*0.005));
      const a=0.45+Math.random()*0.9;
      for(let i=0;i<w && p+i<len;i++){ d[p+i]+=a*Math.exp(-i/(w*0.55)); }
    }
    const src=ctx.createBufferSource(); src.buffer=buf;
    const band=ctx.createBiquadFilter(); band.type='bandpass'; band.frequency.value=2200; band.Q.value=1.2;
    const g=ctx.createGain(); const now=ctx.currentTime;
    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.75, now+0.12);
    g.gain.exponentialRampToValueAtTime(0.4, now+1.2);
    g.gain.exponentialRampToValueAtTime(0.0001, now+dur);
    src.connect(band); band.connect(g); g.connect(ctx.destination); src.start();

    // 結尾「呼」(低頻滑音)
    const osc=ctx.createOscillator(), g2=ctx.createGain();
    osc.frequency.setValueAtTime(90, now+1.6);
    osc.frequency.exponentialRampToValueAtTime(22, now+2.0);
    g2.gain.setValueAtTime(0.28, now+1.6);
    g2.gain.exponentialRampToValueAtTime(0.0001, now+2.05);
    osc.connect(g2); g2.connect(ctx.destination); osc.start(now+1.6); osc.stop(now+2.1);
  }catch(e){ console.warn('音效初始化失敗：', e); }
}

/* 依邊界方向產生火星，朝中心移動 */
function createSparks(){
  const cont=document.getElementById('sparks'); cont.innerHTML=''; cont.style.display='block';
  const W=innerWidth, H=innerHeight, colors=['#ffb86b','#ff9d4d','#ffdca8','#fff2cc','#ffe7b1'];
  for(let i=0;i<90;i++){
    const s=document.createElement('div'); s.className='spark';
    const ang=Math.random()*Math.PI*2, r=Math.max(W,H)*0.6;
    const startX=Math.cos(ang)*r + W/2, startY=Math.sin(ang)*r + H/2;
    const tx = (W/2 - startX), ty = (H/2 - startY);
    s.style.left=startX+'px'; s.style.top=startY+'px';
    s.style.background=colors[Math.floor(Math.random()*colors.length)];
    s.style.setProperty('--sx', tx+'px'); s.style.setProperty('--sy', ty+'px');
    const dur=1.2 + Math.random()*0.8, delay=Math.random()*0.2;
    s.style.animation=`sparkInward ${dur}s ease-out ${delay}s forwards`;
    cont.appendChild(s);
  }
}

/* 點擊流程 */
function ignite(){
  // 1) 確保按一次
  const btn=document.getElementById('ignite');
  btn.style.pointerEvents='none';

  // 2) 顯示遮罩層、啟動動畫（外向內 2s）
  const mask=document.getElementById('mask');
  mask.style.display='block';
  mask.classList.add('run');

  // 3) 內容層被吞噬（2s 同步）
  const content=document.getElementById('contentWrap');
  content.classList.add('fadeContent');

  // 4) 火星 + 音效
  createSparks();
  playSounds();

  // 5) 顯示結尾文字（2s 後，0.8s）
  setTimeout(()=>{
    const t=document.getElementById('fireText');
    t.style.animation='textFade 0.8s ease forwards';
  }, 2000);

  // 6) 淡出轉場 → main.html（2s + 0.8s + 0.5s 緩衝）
  setTimeout(()=>{ window.location.href='main.html'; }, 3300);
}

/* 確保載入完成再綁定（避免某些瀏覽器延遲） */
window.onload = ()=>{
  const btn=document.getElementById('ignite');
  btn.style.pointerEvents='auto';            // ✅ 明確開啟可點
  btn.addEventListener('click', ignite);     // ✅ 綁定點擊
};
</script>
</body>
</html>
