<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>火種解鎖儀式・穩定版</title>
<style>
:root{
  --orange:#ffb86b; --orange2:#ff8c1a; --gold:#ffdca8;
}
html,body{
  margin:0;padding:0;height:100%;
  background:#000;color:var(--orange);
  font-family:'DFKai-SB','標楷體','Times New Roman',Times,serif;
  overflow:hidden;
}

/* 🔥 按鈕永遠可點、閃爍火光 */
#ignite {
  position: relative !important;
  z-index: 9999 !important;
  pointer-events: auto !important;
  display:inline-block;
  border:1px solid var(--orange);
  padding:10px 20px;
  border-radius:12px;
  color:var(--orange);
  text-decoration:none;
  cursor:pointer;
  animation:breathe 1.6s ease-in-out infinite alternate;
  transition:all .2s ease;
}
#ignite:hover{
  color:var(--gold);
  box-shadow:0 0 18px rgba(255,184,107,.65), inset 0 0 8px rgba(255,184,107,.25);
}
@keyframes breathe{
  from{filter:brightness(1);}
  to{filter:brightness(1.25);}
}

/* 🔧 關掉所有遮罩層的互動 */
.maskLayer, .whiteCore, .goldGlow, .edgeNoise, .sparks, .fireText {
  pointer-events:none !important;
}

/* 主容器 */
.wrap{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:5;
}
.panel{
  width:min(720px,92%);
  border:1px solid var(--orange);
  border-radius:14px;
  padding:28px 22px;
  text-align:center;
  line-height:1.9;
  background:#000;
  box-shadow:0 0 24px rgba(255,184,107,.08) inset;
}
.title{font-size:1.3rem;letter-spacing:2px;margin-bottom:12px;}
.input{
  width:95%;max-width:700px;padding:14px 16px;font-size:1.1rem;
  border:1px solid color-mix(in oklab,var(--orange),#000 40%);
  border-radius:10px;background:#0b0b0b;color:var(--orange);
  margin:0 auto 20px;display:block;
}

/* 燒蝕遮罩層 */
.maskLayer{
  position:fixed;inset:0;z-index:10;display:none; /* 點擊後才顯示 */
}
.whiteCore,.goldGlow,.edgeNoise{position:absolute;inset:0;opacity:0;}
.whiteCore{
  background: radial-gradient(circle at 50% 50%, #fff5e1 0%, rgba(255,245,225,0) 65%);
  clip-path: circle(120% at 50% 50%);
}
.goldGlow{
  background: radial-gradient(40% 40% at 50% 50%, rgba(255,184,107,.35) 0%, rgba(255,140,26,.28) 30%, rgba(255,140,26,0) 60%);
  mix-blend-mode:screen;
  clip-path: circle(120% at 50% 50%);
}
.edgeNoise{
  --noise:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="240" height="240"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3"/></filter><rect width="100%" height="100%" filter="url(%23n)" fill="black"/></svg>');
  background: radial-gradient(closest-side,rgba(0,0,0,0) 60%,rgba(0,0,0,0.35) 75%,rgba(0,0,0,0.7) 85%,rgba(0,0,0,0.95) 92%,rgba(0,0,0,1) 100%);
  -webkit-mask:var(--noise);mask:var(--noise);clip-path:circle(120% at 50% 50%);
  mix-blend-mode:multiply;opacity:0;
}

/* 火星 */
.sparks{position:fixed;inset:0;pointer-events:none;z-index:12;display:none;}
.spark{position:absolute;width:3px;height:3px;border-radius:50%;opacity:0;
  filter:drop-shadow(0 0 6px rgba(255,184,107,.9));}
@keyframes sparkInward{
  0%{transform:translate(var(--sx),var(--sy)) scale(1);opacity:0;}
  10%{opacity:1;}
  100%{transform:translate(0,0) scale(0.7);opacity:0;}
}

/* 動畫 */
.fadeContent{transition:opacity 2s ease;opacity:0;}
@keyframes shrinkIn{
  0%{clip-path:circle(120% at 50% 50%);opacity:1;}
  70%{clip-path:circle(12% at 50% 50%);opacity:1;}
  100%{clip-path:circle(6% at 50% 50%);opacity:0;}
}
.run .whiteCore{animation:shrinkIn 2s cubic-bezier(.25,.6,.3,1) forwards;opacity:1;}
.run .goldGlow{animation:shrinkIn 2s cubic-bezier(.25,.6,.3,1) forwards;opacity:1;}
.run .edgeNoise{animation:shrinkIn 2s ease forwards;opacity:.55;}

/* 結尾文字 */
.fireText{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
  font-size:1.6rem;color:var(--orange2);z-index:20;opacity:0;
}
@keyframes textFade{
  0%{opacity:0;}
  10%{opacity:1;}
  80%{opacity:1;}
  100%{opacity:0;}
}
</style>
</head>
<body>
<div class="wrap" id="contentWrap">
  <div class="panel">
    <div class="title">請輸入您的專屬火種序號</div>
    <input class="input" placeholder="例如：A3F9KZ72XZ">
    <a id="ignite" class="btn">點燃火種</a>
  </div>
</div>

<div class="maskLayer" id="mask">
  <div class="whiteCore"></div>
  <div class="goldGlow"></div>
  <div class="edgeNoise"></div>
</div>

<div class="sparks" id="sparks"></div>
<div class="fireText" id="fireText">火種被點燃了....</div>

<script>
let audioCtx=null;

function playSounds(){
  try{
    if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    const ctx=audioCtx, dur=2.0, sr=ctx.sampleRate, len=sr*dur, buf=ctx.createBuffer(1,len,sr), d=buf.getChannelData(0);
    for(let i=0;i<len;i++) d[i]=(Math.random()*2-1)*0.16;
    for(let k=0;k<90;k++){
      const p=Math.floor(Math.random()*len), w=Math.floor(sr*(0.002+Math.random()*0.005)), a=0.45+Math.random()*0.9;
      for(let i=0;i<w&&p+i<len;i++){d[p+i]+=a*Math.exp(-i/(w*0.55));}
    }
    const src=ctx.createBufferSource();src.buffer=buf;
    const band=ctx.createBiquadFilter();band.type='bandpass';band.frequency.value=2200;band.Q.value=1.2;
    const g=ctx.createGain();const now=ctx.currentTime;
    g.gain.setValueAtTime(0.0001,now);
    g.gain.exponentialRampToValueAtTime(0.75,now+0.12);
    g.gain.exponentialRampToValueAtTime(0.4,now+1.2);
    g.gain.exponentialRampToValueAtTime(0.0001,now+dur);
    src.connect(band);band.connect(g);g.connect(ctx.destination);src.start();
    const osc=ctx.createOscillator(),g2=ctx.createGain();
    osc.frequency.setValueAtTime(90,now+1.6);
    osc.frequency.exponentialRampToValueAtTime(22,now+2.0);
    g2.gain.setValueAtTime(0.28,now+1.6);
    g2.gain.exponentialRampToValueAtTime(0.0001,now+2.05);
    osc.connect(g2);g2.connect(ctx.destination);osc.start(now+1.6);osc.stop(now+2.1);
  }catch(e){console.warn("音效失敗",e);}
}

function createSparks(){
  const cont=document.getElementById('sparks');
  cont.innerHTML='';cont.style.display='block';
  const W=innerWidth,H=innerHeight,colors=['#ffb86b','#ff9d4d','#ffdca8','#fff2cc','#ffe7b1'];
  for(let i=0;i<90;i++){
    const s=document.createElement('div');s.className='spark';
    const ang=Math.random()*Math.PI*2,r=Math.max(W,H)*0.6;
    const startX=Math.cos(ang)*r+W/2,startY=Math.sin(ang)*r+H/2;
    const tx=(W/2-startX),ty=(H/2-startY);
    s.style.left=startX+'px';s.style.top=startY+'px';
    s.style.background=colors[Math.floor(Math.random()*colors.length)];
    s.style.setProperty('--sx',tx+'px');s.style.setProperty('--sy',ty+'px');
    const dur=1.2+Math.random()*0.8,delay=Math.random()*0.2;
    s.style.animation=`sparkInward ${dur}s ease-out ${delay}s forwards`;
    cont.appendChild(s);
  }
}

function ignite(){
  console.log("🔥 點燃火種按鈕綁定成功");
  const btn=document.getElementById('ignite');
  btn.style.pointerEvents='none';
  const mask=document.getElementById('mask');
  mask.style.display='block';
  mask.classList.add('run');
  const content=document.getElementById('contentWrap');
  content.classList.add('fadeContent');
  createSparks();
  playSounds();

  // 顯示「火種被點燃了」
  setTimeout(()=>{
    document.getElementById('fireText').style.animation='textFade 2.5s ease forwards';
  },2000);

  // ✅ 儲存解鎖狀態（這是關鍵）
  localStorage.setItem("fireUnlocked", "true");

  // 跳轉主頁
  setTimeout(()=>{
    window.location.href='main.html';
  },4300);
}

window.onload=()=>{
  const btn=document.getElementById('ignite');
  btn.style.pointerEvents='auto';
  btn.addEventListener('click',ignite);
};
</script>
</body>
</html>
