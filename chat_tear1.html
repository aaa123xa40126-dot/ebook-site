<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>淚．一</title>
<style>
  body {
    margin:0;
    font-family:'標楷體','Times New Roman', serif;
    background:#000;
    height:100vh;
    display:flex;
    flex-direction:column;
    color:#fff;
  }
  .chat-header {
    background:#111;
    color:#ffb347;
    padding:14px;
    font-size:20px;
    font-weight:bold;
    text-align:center;
    letter-spacing:1px;
    border-bottom:1px solid #333;
  }
  .chat-stream {
    flex:1;
    overflow-y:auto;
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:14px;
  }
  .row {
    display:flex;
    align-items:flex-end;
    gap:8px;
  }
  .row.left { justify-content:flex-start; }
  .row.right { justify-content:flex-end; }
  .narration {
    text-align:center;
    color:#aaa;
    font-style:italic;
    margin:6px 0;
    line-height:1.6;
    opacity:0;
    transition: opacity 1s ease-in;
  }
  .narration.show { opacity:1; }
  .avatar {
    flex:0 0 44px;
    width:44px; height:44px;
    border-radius:50%;
    overflow:hidden;
    background:#333;
  }
  .avatar img { width:100%; height:100%; object-fit:cover; }
  .bubble {
    max-width:70%;
    padding:12px 16px;
    border-radius:18px;
    line-height:1.6;
    word-break:break-word;
    font-size:17px;
    background:#111;
    border:1px solid #444;
    box-shadow:0 2px 6px rgba(255,255,255,.1);
  }
  .row.left .bubble { color:#ffb347; }
  .typing { display:inline-block; min-width:40px }
  .typing .dot{
    width:8px;height:8px;border-radius:50%;
    display:inline-block;margin:0 2px;
    background:rgba(255,255,255,.5);
    animation:bounce 1.5s infinite ease-in-out;
  }
  .typing .dot:nth-child(2){animation-delay:.2s}
  .typing .dot:nth-child(3){animation-delay:.4s}
  @keyframes bounce{0%,80%,100%{transform:scale(.6);opacity:.5}40%{transform:scale(1);opacity:1}}
</style>
</head>
<body>
  <div class="chat-header">淚．一</div>
  <div class="chat-stream" id="stream"></div>

<script>
const script = [
  {speaker:'narration', text:'深夜，房間漆黑，只剩下提燈的光。卉曦已經睡著。'},
  {speaker:'front', side:'left', text:'……看來今天的您也做了個美夢呢。（低聲'},
  {speaker:'narration', text:'（伸手，替卉曦拉好被子）'},
  {speaker:'narration', text:'（名祭靜靜地盯著卉曦的臉，眼淚不自覺流下。）'},
  {speaker:'front', side:'left', text:'……我知道的。'},
  {speaker:'front', side:'left', text:'即便我的手被割破的滿手是血，您也回不來，我知道的。'},
  {speaker:'narration', text:'（卉曦笑的甜美，好像做了個美好的夢）'},
  {speaker:'front', side:'left', text:'我想您了，那個您。'},
  {speaker:'narration', text:'（她的聲音顫抖，卻努力壓低，怕吵醒卉曦。）'},
  {speaker:'front', side:'left', text:'……沒事的。現在這樣……也很好。'},
  {speaker:'front', side:'left', text:'我會守著的。就算是碎片……就算是現在的您……'},
  {speaker:'front', side:'left', text:'……只要您還在笑，我就會留下。'},
  {speaker:'narration', text:'（淚水不斷落下，從未停止。）'},
  {speaker:'front', side:'left', text:'……可是啊，為什麼只有我……'},
  {speaker:'front', side:'left', text:'記得完整的您呢……'},
  {speaker:'narration', text:'（名祭蹲在卉曦床前，緊抱提燈，無聲落淚，夜還很長。）'}
];

const AVATARS = { front:'front.png', back:'back.png' };

let i = 0;
const stream = document.getElementById('stream');

function addNarration(text){
  const n = document.createElement('div');
  n.className = 'narration';
  n.textContent = text;
  stream.appendChild(n);
  stream.scrollTop = stream.scrollHeight;
  setTimeout(()=>{ n.classList.add('show'); },50);
}

function addTyping(side, who){
  const row = document.createElement('div');
  row.className = 'row ' + side;
  const avatar = document.createElement('div');
  avatar.className = 'avatar';
  const img = document.createElement('img');
  img.src = AVATARS[who];
  avatar.appendChild(img);
  const bubble = document.createElement('div');
  bubble.className = 'bubble typing';
  bubble.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
  if(side==='left'){ row.appendChild(avatar); row.appendChild(bubble); }
  else { row.appendChild(bubble); row.appendChild(avatar); }
  stream.appendChild(row);
  stream.scrollTop = stream.scrollHeight;
  return row;
}

function addMessage(side, who, text){
  const row = document.createElement('div');
  row.className = 'row ' + side;
  const avatar = document.createElement('div');
  avatar.className = 'avatar';
  const img = document.createElement('img');
  img.src = AVATARS[who];
  avatar.appendChild(img);
  const bubble = document.createElement('div');
  bubble.className = 'bubble';
  bubble.textContent = text;
  if(side==='left'){ row.appendChild(avatar); row.appendChild(bubble); }
  else { row.appendChild(bubble); row.appendChild(avatar); }
  stream.appendChild(row);
  stream.scrollTop = stream.scrollHeight;
}

function step(){
  if(i >= script.length) return;
  const entry = script[i];
  if(entry.speaker==='narration'){
    setTimeout(()=>{
      addNarration(entry.text);
      i++;
      setTimeout(step, 3000);
    }, 3000);
  } else {
    const {speaker, side, text} = entry;
    const typeRow = addTyping(side, speaker);
    const delay = 5000; 
    setTimeout(()=>{
      typeRow.remove();
      addMessage(side, speaker, text);
      i++;
      setTimeout(step, 800);
    }, delay);
  }
}
step();
</script>
  <script type="module" src="firebase-init.js"></script>
</body>
</html>
